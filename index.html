<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>

</head>

<body>
    <script>

        window.web3 = new Web3(ethereum); // get web3 object and store it in window



        const contractAddress = "0xaA694E5BCe88A39cb75B765357549CE8AEF70f5f";
        console.log("contractAddress",contractAddress);

        const abi = [
            {
                "inputs": [],
                "stateMutability": "payable",
                "type": "constructor"
            },
            {
                "inputs": [],
                "name": "getAllPaymentsHistory",
                "outputs": [
                    {
                        "components": [
                            {
                                "internalType": "address",
                                "name": "to",
                                "type": "address"
                            },
                            {
                                "internalType": "uint256",
                                "name": "amount",
                                "type": "uint256"
                            },
                            {
                                "internalType": "uint256",
                                "name": "timestamp",
                                "type": "uint256"
                            }
                        ],
                        "internalType": "struct Payment.Pay[]",
                        "name": "",
                        "type": "tuple[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getContractBal",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getLastPayment",
                "outputs": [
                    {
                        "components": [
                            {
                                "internalType": "address",
                                "name": "to",
                                "type": "address"
                            },
                            {
                                "internalType": "uint256",
                                "name": "amount",
                                "type": "uint256"
                            },
                            {
                                "internalType": "uint256",
                                "name": "timestamp",
                                "type": "uint256"
                            }
                        ],
                        "internalType": "struct Payment.Pay",
                        "name": "",
                        "type": "tuple"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getOwnerBalance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_address",
                        "type": "address"
                    }
                ],
                "name": "getPaymentHistoryByAddress",
                "outputs": [
                    {
                        "components": [
                            {
                                "internalType": "address",
                                "name": "to",
                                "type": "address"
                            },
                            {
                                "internalType": "uint256",
                                "name": "amount",
                                "type": "uint256"
                            },
                            {
                                "internalType": "uint256",
                                "name": "timestamp",
                                "type": "uint256"
                            }
                        ],
                        "internalType": "struct Payment.Pay",
                        "name": "",
                        "type": "tuple"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address payable",
                        "name": "_to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "_amount",
                        "type": "uint256"
                    }
                ],
                "name": "pay",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "paymentsArray",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "timestamp",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "paymentsMap",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "timestamp",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];


        const currentAccount = async()=>{
           const acc = await window.web3.eth.accounts[0];
           console.log("currentAccount",acc);
        }
        currentAccount();

        const userBal = async()=>{
            const bal = await window.web3.eth.getBalance(window.web3.eth.accounts[0]);
            console.log("User Balance",bal);
        }
        userBal();



        const contractBal = async()=>{
            const contract = new window.web3.eth.Contract(abi,contractAddress);
            const bal = await contract.methods.getContractBal().call();
            console.log("contractBal",web3.utils.fromWei(bal));
        }

        contractBal();

        
        const send = async()=>{
            await window.web3.eth.sendTransaction({
                from: window.web3.eth.accounts[0],
                to: contractAddress,
                value: window.web3.utils.toWei('1', 'ether')
            });
        }
        // send();

        // const provider = new ethers.providers.JsonRpcProvider('HTTP://127.0.0.1:7545'); //open ganache gui in bg.
        // const signer = provider.getSigner();

        // const contract = new ethers.Contract(contractAddress, abi, signer);

        // const getContractBal = async () => {
        //     const bal = await contract.getContractBal();
        //     console.log('contract bal : ',ethers.utils.formatEther(bal));
        // }

        // getContractBal();


        // const userAddress = async () => {
        //     const address = await signer.getAddress();
        //     console.log("user address : ",address);
        // }

        // userAddress();

        // const payToContract = async () => {
        //    await signer.sendTransaction({
        //     to: contractAddress,
        //     value: ethers.utils.parseEther('1')
        // });
        // }

        // console.log('pay to contract : ',payToContract());


        // const pay = async () => {
        //     const to = await signer.getAddress();
        //     const amount = ethers.utils.parseEther('5');
        //     const tx = await contract.pay(to, amount);
        //     console.log('tx : ',tx);
        // }

        // pay();

    </script>
</body>

</html>